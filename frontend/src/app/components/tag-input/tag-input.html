<div class="tag-input-container">
    <!-- Selected Tags -->
    <div class="selected-tags d-flex flex-wrap gap-1 mb-2" *ngIf="selectedTags().length > 0">
        @for (tag of selectedTags(); track tag.id) {
            <span class="badge rounded-pill d-inline-flex align-items-center gap-1 px-2 py-1"
                  [style.background-color]="tag.color"
                  [style.color]="'white'">
                {{ tag.name }}
                <button type="button" class="btn-close btn-close-white ms-1" 
                        style="font-size: 0.6rem;"
                        (click)="removeTag(tag)"
                        aria-label="Rimuovi"></button>
            </span>
        }
    </div>
    
    <!-- Search Input -->
    <div class="position-relative">
        <div class="input-group">
            <span class="input-group-text bg-light border-0">
                <i class="fa-solid fa-tag text-muted"></i>
            </span>
            <input type="text"
                   class="form-control bg-light border-0"
                   [placeholder]="placeholder"
                   [(ngModel)]="searchQuery"
                   (input)="onSearchChange()"
                   (focus)="onFocus()"
                   (blur)="onBlur()"
                   (keydown)="onKeydown($event)">
            @if (isLoading()) {
                <span class="input-group-text bg-light border-0">
                    <div class="spinner-border spinner-border-sm text-muted" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </span>
            }
        </div>
        
        <!-- Suggestions Dropdown -->
        @if (showSuggestions() && (suggestions().length > 0 || hasNewTagOption)) {
            <div class="suggestions-dropdown position-absolute w-100 shadow-sm rounded-bottom bg-white border border-top-0 z-3">
                @for (tag of suggestions(); track tag.id) {
                    <div class="suggestion-item px-3 py-2 d-flex align-items-center gap-2"
                         (mousedown)="selectTag(tag)">
                        <span class="tag-dot" [style.background-color]="tag.color"></span>
                        <span class="flex-grow-1">{{ tag.name }}</span>
                        @if (tag.usageCount > 0) {
                            <small class="text-muted">{{ tag.usageCount }} ricette</small>
                        }
                    </div>
                }
                
                @if (hasNewTagOption) {
                    <div class="suggestion-item create-new px-3 py-2 d-flex align-items-center gap-2 border-top"
                         (mousedown)="createNewTag()">
                        <i class="fa-solid fa-circle-plus text-success"></i>
                        <span>Crea "<strong>{{ searchQuery }}</strong>"</span>
                    </div>
                }
            </div>
        }
    </div>
</div>
